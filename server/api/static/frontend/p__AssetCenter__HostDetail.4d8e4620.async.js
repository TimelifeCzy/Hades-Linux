"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[414],{24342:function(ce,z,n){n.r(z);var J=n(15009),a=n.n(J),k=n(99289),p=n.n(k),Q=n(19632),F=n.n(Q),T=n(5574),Y=n.n(T),O=n(93769),X=n(12121),x=n(38345),m=n(99765),C=n(56346),q=n(47375),L=n(97269),G=n(64317),W=n(97462),K=n(67294),H=n(80854),Z=n(30381),A=n.n(Z),S=n(48555),s=n(18145),_=n(80737),I=n(71577),h=n(12461),u=n(24969),w=n(49748),e=n(85893),me=O.Z.Divider,ve=[{title:"\u63D2\u4EF6\u540D\u79F0",dataIndex:"name"},{title:"\u7248\u672C",search:!1,dataIndex:"pversion"},{title:"\u72B6\u6001",search:!1,dataIndex:"status",valueEnum:{true:{text:"\u5728\u7EBF",status:"Success"},false:{text:"\u79BB\u7EBF",status:"Error"}}},{title:"\u4E0A\u4F20\u901F\u7387(Kb/s)",search:!1,width:"10%",dataIndex:"tx_speed",renderText:function(d){return(d/1024).toFixed(2)}},{title:"\u4E0A\u4F20 TPS",search:!1,width:"10%",dataIndex:"tx_tps",renderText:function(d){return d.toFixed(2)}},{title:"\u4E0A\u7EBF\u65F6\u95F4",search:!1,dataIndex:"start_at",renderText:function(d){var c=new Date(d*1e3);return A()(c).utc(!0).format("YYYY-MM-DD HH:mm:ss")}},{title:"\u6700\u8FD1\u5FC3\u8DF3\u65F6\u95F4",search:!1,dataIndex:"last_heartbeat_time",renderText:function(d){var c=new Date(d*1e3);return A()(c).utc(!0).format("YYYY-MM-DD HH:mm:ss")}},{title:"\u64CD\u4F5C",search:!1,valueType:"option",key:"option",dataIndex:"",render:function(d,c,D,R){return[(0,e.jsx)("a",{href:"host/"+c.agent_id,rel:"noopener noreferrer",children:"\u5347\u7EA7"},"upgrade"),(0,e.jsx)("a",{href:"host/"+c.agent_id,rel:"noopener noreferrer",children:"\u5378\u8F7D"},"remove")]}}],pe=[{title:"PID",dataIndex:"pid",width:"5%"},{title:"PPID",search:!1,dataIndex:"ppid",width:"5%"},{title:"\u8FDB\u7A0B\u540D",dataIndex:"name",width:"10%"},{title:"\u6267\u884C\u6587\u4EF6",dataIndex:"exe",ellipsis:!0,width:"30%"},{title:"UID",search:!1,dataIndex:"uid",width:"5%"},{title:"\u7528\u6237\u540D",search:!1,dataIndex:"username",width:"10%",ellipsis:!0},{title:"\u542F\u52A8\u65F6\u95F4",search:!1,dataIndex:"starttime",renderText:function(d){var c=new Date(d*1e3);return A()(c).utc(!0).format("YYYY-MM-DD HH:mm:ss")}}],he=[{title:"UID",dataIndex:"uid",width:"5%"},{title:"GID",search:!1,dataIndex:"gid",width:"5%"},{title:"\u7528\u6237\u540D",dataIndex:"username",width:"10%"},{title:"\u5386\u53F2\u767B\u5F55 IP",dataIndex:"last_login_ip",ellipsis:!0,width:"20%"},{title:"shell",search:!1,dataIndex:"shell",width:"20%"}],ge=[{title:"PID",dataIndex:"pid",width:"5%"},{title:"\u547D\u4EE4",search:!1,dataIndex:"comm",width:"10%"},{title:"dip",dataIndex:"dip",width:"5%"},{title:"dport",dataIndex:"dport",ellipsis:!0,width:"5%"},{title:"sip",search:!1,dataIndex:"sip",width:"5%"},{title:"sport",search:!1,dataIndex:"sport",width:"5%"},{title:"\u547D\u4EE4",search:!1,dataIndex:"cmdline",width:"20%",ellipsis:!0}],Ee=[];function ee(g){var d,c,D=0;if(g.plugins_info!==void 0)for(var R in g.plugins_info){var M,j;D+=(M=(j=g.plugins_info[R])===null||j===void 0?void 0:j.cpu)!==null&&M!==void 0?M:0}return D+=(d=(c=g.agent_info)===null||c===void 0?void 0:c.cpu)!==null&&d!==void 0?d:0,D}function te(g){var d,c,D=0;if(g.plugins_info!==void 0)for(var R in g.plugins_info){var M,j;D+=(M=(j=g.plugins_info[R])===null||j===void 0?void 0:j.rss)!==null&&M!==void 0?M:0}return D+=(d=(c=g.agent_info)===null||c===void 0?void 0:c.rss)!==null&&d!==void 0?d:0,D=D/(1024*1024),D}var De=function(){var d,c,D,R,M,j,ne,ae,re,U=(0,H.useParams)(),Ie=(0,K.useRef)(),xe=(0,K.useState)(!1),le=Y()(xe,2),oe=le[0],Pe=le[1],_e={},be=K.useState(_e),de=Y()(be,2),i=de[0],Me=de[1],je=_.Z.useForm(),Te=Y()(je,1),Oe=Te[0],Fe=(0,H.useRequest)(function(v){return(0,w.pi)({agent_id:U.agent_id})},{pollingInterval:3e3}),N=Fe.data,$=(d=(0,H.useRequest)(w.UV).data)===null||d===void 0?void 0:d.plugins;return K.useEffect(function(){Me(N!=null?N:_e)},[N]),(0,e.jsxs)(X._z,{title:" ",children:[(0,e.jsx)(x.Z,{title:"\u57FA\u7840\u4FE1\u606F",children:(0,e.jsxs)(m.vY,{actionRef:Ie,column:4,dataSource:i,children:[(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","hostname"],label:"\u4E3B\u673A\u540D\u79F0"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","intranet_ipv4"],label:"\u5185\u7F51 IPv4"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","pid"],label:"PID"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","boot_at"],label:"\u7CFB\u7EDF\u542F\u52A8\u65F6\u95F4",renderText:function(l){var f=new Date(l*1e3);return A()(f).utc(!0).format("YYYY-MM-DD HH:mm:ss")}}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","arch"],label:"\u7CFB\u7EDF\u67B6\u6784"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","intranet_ipv6"],label:"\u5185\u7F51 IPv6"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","addr"],label:"\u8FDE\u63A5\u5730\u5740"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","last_heartbeat_time"],label:"\u6700\u8FD1\u5FC3\u8DF3\u65F6\u95F4",renderText:function(l){var f=new Date(l*1e3);return A()(f).utc(!0).format("YYYY-MM-DD HH:mm:ss")}}),(0,e.jsx)(m.vY.Item,{dataIndex:"agent_info",label:"\u7CFB\u7EDF\u7248\u672C",renderText:function(l){return l!==void 0?l.platform+" "+l.platform_family+" "+l.platform_version:"-"}}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","extranet_ipv4"],label:"\u516C\u7F51 IPv4"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","grs"],label:"Goroutine"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","boot_at"],label:"Agent\u542F\u52A8\u65F6\u95F4",renderText:function(l){var f=new Date(l*1e3);return A()(f).utc(!0).format("YYYY-MM-DD HH:mm:ss")}}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","kernel_version"],label:"\u5185\u6838\u7248\u672C"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","extranet_ipv6"],label:"\u516C\u7F51 IPv6"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","version"],label:"Agent\u7248\u672C"}),(0,e.jsx)(m.vY.Item,{dataIndex:["agent_info","online"],label:"\u5BA2\u6237\u7AEF\u72B6\u6001",valueEnum:{all:{text:"\u5168\u90E8",status:"Default"},false:{text:"\u79BB\u7EBF",status:"Error"},true:{text:"\u5728\u7EBF",status:"Success"}}})]})}),(0,e.jsx)("p",{}),(0,e.jsx)(x.Z,{title:"\u6027\u80FD\u8D1F\u8F7D",children:(0,e.jsx)(S.Z,{onResize:function(l){Pe(l.width<596)},children:(0,e.jsxs)(O.Z.Group,{direction:oe?"column":"row",children:[(0,e.jsx)(O.Z,{statistic:{title:"Agent CPU",value:ee(i)*100,suffix:"%",precision:2},chart:(0,e.jsx)(s.Z,{height:70,width:70,innerRadius:.7,renderer:"svg",data:[{name:"",value:.1-ee(i)},{name:"CPU",value:ee(i)}],angleField:"value",colorField:"name",statistic:void 0,legend:!1,tooltip:!1,label:!1,color:["#f5f5f5","#6394f9"]}),chartPlacement:"left"}),(0,e.jsx)(O.Z,{statistic:{title:"Agent \u5185\u5B58",value:te(i),suffix:"Mb",precision:2},chart:(0,e.jsx)(s.Z,{height:70,width:70,innerRadius:.7,renderer:"svg",data:[{name:"",value:250-te(i)},{name:"\u5185\u5B58",value:te(i)}],angleField:"value",colorField:"name",statistic:void 0,legend:!1,tooltip:!1,label:!1,color:["#f5f5f5","#6394f9"]}),chartPlacement:"left"}),(0,e.jsx)(me,{type:oe?"horizontal":"vertical"}),(0,e.jsx)(O.Z,{statistic:{title:"\u7CFB\u7EDF CPU",value:i==null||(c=i.agent_info)===null||c===void 0?void 0:c.sys_cpu,suffix:"%",precision:2},chart:(0,e.jsx)(s.Z,{height:70,width:70,innerRadius:.7,renderer:"svg",data:[{name:"",value:100-((D=i==null||(R=i.agent_info)===null||R===void 0?void 0:R.sys_cpu)!==null&&D!==void 0?D:0)},{name:"CPU",value:i==null||(M=i.agent_info)===null||M===void 0?void 0:M.sys_cpu}],angleField:"value",colorField:"name",statistic:void 0,legend:!1,tooltip:!1,label:!1,color:["#f5f5f5","#6394f9"]}),chartPlacement:"left"}),(0,e.jsx)(O.Z,{statistic:{title:"\u7CFB\u7EDF\u5185\u5B58",value:i==null||(j=i.agent_info)===null||j===void 0?void 0:j.sys_mem,suffix:"%",precision:2},chart:(0,e.jsx)(s.Z,{height:70,width:70,innerRadius:.7,renderer:"svg",data:[{name:"",value:100-((ne=i==null||(ae=i.agent_info)===null||ae===void 0?void 0:ae.sys_mem)!==null&&ne!==void 0?ne:0)},{name:"\u5185\u5B58",value:i==null||(re=i.agent_info)===null||re===void 0?void 0:re.sys_mem}],angleField:"value",colorField:"name",statistic:void 0,legend:!1,tooltip:!1,label:!1,color:["#f5f5f5","#6394f9"]}),chartPlacement:"left"})]})},"resize-observer")}),(0,e.jsx)("p",{}),(0,e.jsxs)(x.Z,{tabs:{type:"card"},title:"\u4E3B\u673A\u8BE6\u60C5",children:[(0,e.jsx)(x.Z.TabPane,{tab:"\u63D2\u4EF6\u5217\u8868",children:(0,e.jsx)(C.Z,{columns:ve,options:!1,rowKey:function(){return Math.random()},dataSource:i.plugins_info,search:{defaultCollapsed:!1,labelWidth:"auto",optionRender:function(l,f,y){return[(0,e.jsx)(q.Y,{title:"\u4E0B\u53D1\u63D2\u4EF6",trigger:(0,e.jsxs)(I.Z,{type:"primary",children:[(0,e.jsx)(u.Z,{}),"\u4E0B\u53D1\u63D2\u4EF6"]}),form:Oe,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},submitTimeout:2e3,onFinish:function(o){var r,P;return(0,w.nc)({name:(r=o.name)!==null&&r!==void 0?r:"",pversion:o.pversion,agent_id:(P=U.agent_id)!==null&&P!==void 0?P:""}).then(function(t){return t.code!=0?(h.ZP.error("\u4E0B\u53D1\u5931\u8D25:"+t.data),!1):(h.ZP.success("\u4E0B\u53D1\u6210\u529F"),t)})},children:(0,e.jsxs)(L.A.Group,{children:[(0,e.jsx)(G.Z,{width:"md",name:"name",label:"\u63D2\u4EF6\u540D\u79F0",labelAlign:"left",request:p()(a()().mark(function B(){var o,r,P,t,V;return a()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:o=new Array,r=new Map,E.t0=a()().keys($);case 3:if((E.t1=E.t0()).done){E.next=15;break}if(P=E.t1.value,t=$[P].name,r.get(t)!==!0){E.next=10;break}return E.abrupt("continue",3);case 10:r.set(t,!0);case 11:V={label:t,value:t},o.push(V),E.next=3;break;case 15:return E.abrupt("return",o);case 16:case"end":return E.stop()}},B)})),placeholder:"\u8BF7\u9009\u62E9\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u63D2\u4EF6\u540D\u79F0"}]}),(0,e.jsx)(W.Z,{name:["name"],ignoreFormListField:!0,children:function(o){var r=o.name;return(0,e.jsx)(G.Z,{width:"md",name:"pversion",params:{name:r},request:function(){var P=p()(a()().mark(function t(V){var se,E,ue,ie,fe;return a()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:se=V.name,E=new Array,b.t0=a()().keys($);case 3:if((b.t1=b.t0()).done){b.next=12;break}if(ue=b.t1.value,$[ue].name==se){b.next=7;break}return b.abrupt("continue",3);case 7:ie=$[ue].pversion,fe={label:ie,value:ie},E.push(fe),b.next=3;break;case 12:return b.abrupt("return",E);case 13:case"end":return b.stop()}},t)}));return function(t){return P.apply(this,arguments)}}(),label:"\u63D2\u4EF6\u7248\u672C",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C",rules:[{required:!0}]})}})]})})].concat(F()(y.reverse()))}}})},"tab1"),(0,e.jsx)(x.Z.TabPane,{tab:"\u8FDB\u7A0B\u5217\u8868",children:(0,e.jsx)(C.Z,{columns:pe,options:!1,rowKey:function(){return Math.random()},request:function(){var v=p()(a()().mark(function l(f,y,B){var o,r;return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,w.Nh)({type:"processes",agent_id:(o=U.agent_id)!==null&&o!==void 0?o:"",page:f.current,size:f.pageSize,order_key:"pid",order_value:1});case 2:return r=t.sent,t.abrupt("return",{data:r.data.assets,success:r.code==0,total:r.data.total});case 4:case"end":return t.stop()}},l)}));return function(l,f,y){return v.apply(this,arguments)}}()})},"tab2"),(0,e.jsx)(x.Z.TabPane,{tab:"\u7F51\u7EDC\u8FDB\u7A0B",children:(0,e.jsx)(C.Z,{columns:ge,options:!1,rowKey:function(){return Math.random()},request:function(){var v=p()(a()().mark(function l(f,y,B){var o,r;return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,w.Nh)({type:"sockets",agent_id:(o=U.agent_id)!==null&&o!==void 0?o:"",page:f.current,size:f.pageSize,order_key:"pid",order_value:1});case 2:return r=t.sent,t.abrupt("return",{data:r.data.assets,success:r.code==0,total:r.data.total});case 4:case"end":return t.stop()}},l)}));return function(l,f,y){return v.apply(this,arguments)}}()})},"tab3"),(0,e.jsx)(x.Z.TabPane,{tab:"\u7528\u6237\u5217\u8868",children:(0,e.jsx)(C.Z,{columns:he,options:!1,rowKey:function(){return Math.random()},request:function(){var v=p()(a()().mark(function l(f,y,B){var o,r;return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,w.Nh)({type:"users",agent_id:(o=U.agent_id)!==null&&o!==void 0?o:"",page:f.current,size:f.pageSize,order_key:"uid",order_value:1});case 2:return r=t.sent,t.abrupt("return",{data:r.data.assets,success:r.code==0,total:r.data.total});case 4:case"end":return t.stop()}},l)}));return function(l,f,y){return v.apply(this,arguments)}}()})},"tab4"),(0,e.jsx)(x.Z.TabPane,{tab:"\u5B9A\u65F6\u4EFB\u52A1",children:(0,e.jsx)(C.Z,{columns:Ee,options:!1,rowKey:function(){return Math.random()},request:function(){var v=p()(a()().mark(function l(f,y,B){var o,r;return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,w.Nh)({type:"crons",agent_id:(o=U.agent_id)!==null&&o!==void 0?o:"",page:f.current,size:f.pageSize,order_key:"uid",order_value:1});case 2:return r=t.sent,t.abrupt("return",{data:r.data.assets,success:r.code==0,total:r.data.total});case 4:case"end":return t.stop()}},l)}));return function(l,f,y){return v.apply(this,arguments)}}()})},"tab4")]})]})};z.default=De},49748:function(ce,z,n){n.d(z,{Ek:function(){return Y},LH:function(){return H},Nh:function(){return A},UV:function(){return G},Zs:function(){return X},nc:function(){return q},pi:function(){return m},sk:function(){return K}});var J=n(15009),a=n.n(J),k=n(97857),p=n.n(k),Q=n(99289),F=n.n(Q),T=n(80854);function Y(s){return O.apply(this,arguments)}function O(){return O=F()(a()().mark(function s(_){return a()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)("/api/v1/grpc/conn/count",p()({method:"GET"},_||{})));case 1:case"end":return h.stop()}},s)})),O.apply(this,arguments)}function X(s,_){return x.apply(this,arguments)}function x(){return x=F()(a()().mark(function s(_,I){return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,T.request)("/api/v1/grpc/conn/basic",p()({method:"GET",params:p()({},_)},I||{})));case 1:case"end":return u.stop()}},s)})),x.apply(this,arguments)}function m(s,_){return C.apply(this,arguments)}function C(){return C=F()(a()().mark(function s(_,I){return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,T.request)("/api/v1/grpc/conn/stat",p()({method:"GET",params:p()({},_)},I||{})));case 1:case"end":return u.stop()}},s)})),C.apply(this,arguments)}function q(s,_){return L.apply(this,arguments)}function L(){return L=F()(a()().mark(function s(_,I){return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,T.request)("/api/v1/plugin/send",p()({method:"POST",data:JSON.stringify({name:_.name,pversion:_.pversion,agent_id:_.agent_id}),headers:{"Content-Type":"application/json"}},I||{})));case 1:case"end":return u.stop()}},s)})),L.apply(this,arguments)}function G(s){return W.apply(this,arguments)}function W(){return W=F()(a()().mark(function s(_){return a()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)("/api/v1/plugin/list",p()({method:"GET"},_||{})));case 1:case"end":return h.stop()}},s)})),W.apply(this,arguments)}function K(s){return(0,T.request)("/api/v1/plugin/delete",p()({method:"GET"},s||{}))}function H(s,_){return Z.apply(this,arguments)}function Z(){return Z=F()(a()().mark(function s(_,I){return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,T.request)(_,p()({},I||{})));case 1:case"end":return u.stop()}},s)})),Z.apply(this,arguments)}function A(s,_){return S.apply(this,arguments)}function S(){return S=F()(a()().mark(function s(_,I){return a()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,T.request)("/api/v1/asset/get",p()({method:"GET",params:_},I||{})));case 1:case"end":return u.stop()}},s)})),S.apply(this,arguments)}}}]);
